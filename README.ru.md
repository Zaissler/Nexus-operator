# Nexus Operator

[English Version](README.md)

Nexus Operator — это инструмент на языке Go, предназначенный для экспорта и импорта файлов из/в репозиторий Nexus Repository Manager. Программа автоматически обрабатывает структуру файлов Maven и npm, а также поддерживает аутентификацию для защищенных репозиториев.

Ключевые возможности
- Параллельная обработка: Значительно ускоряет экспорт и импорт за счет одновременной обработки нескольких файлов.
- Экспорт файлов: Скачивает все артефакты из указанного репозитория Nexus и сохраняет их в локальную директорию с сохранением структуры.
- Импорт файлов: Загружает файлы из локальной директории в репозиторий Nexus.
- Поддержка форматов:
  - Maven, npm, Raw, PyPI, NuGet, Helm, Yum, Apt.
- Поддержка аутентификации: Basic Auth для работы с защищенными репозиториями.
- Безопасность: Режим "пробного запуска" (`--dry-run`) для проверки операций без внесения изменений.

Требования
- Go 1.20 или выше.
- Доступ к Nexus Repository Manager (URL, имя репозитория).
- Права на чтение/запись в репозиторий (если требуется).

## Установка

Из исходного кода
1. `git clone https://github.com/your-repo/nexus-operator.git && cd nexus-operator`
2. `go build -o nexus-operator`

С помощью `go install`
Убедитесь, что ваш `$GOPATH/bin` или `$HOME/go/bin` добавлен в `PATH`.
go install github.com/your-repo/nexus-operator@latest

## Использование

### Экспорт
Чтобы экспортировать файлы из репозитория Nexus, выполните команду:

`./nexus-operator -repo-url=https://nexus.example.com -repo-name=maven-test -action=export -repo-type=maven`

Программа создаст директорию с именем репозитория (например, `maven-test`) и скачает в нее все артефакты, сохраняя их структуру.

### Импорт
Чтобы импортировать файлы в репозиторий Nexus, выполните команду:

`./nexus-operator -repo-url=https://nexus.example.com -repo-name=my-npm-repo -action=import -import-dir=./local-npm-packages -repo-type=npm -username=admin -password=admin123`

Программа загрузит все подходящие файлы из указанной директории в репозиторий Nexus.

### Пробный запуск (Dry Run)
Чтобы увидеть, какие файлы будут обработаны, без реального скачивания или загрузки, используйте флаг `-dry-run`:

`./nexus-operator -action=import -repo-type=maven -dry-run=true ...`

## Флаги командной строки
Флаг            | Описание                                      | Обязательный | Пример значения
------------------|-----------------------------------------------|--------------|-------------------------------------
-repo-url         | Базовый URL Nexus Repository Manager          | Да           | https://nexus.example.com
-repo-name        | Имя репозитория                               | Да           | maven-test
-action           | Действие: `export` или `import`               | Да           | export
-import-dir       | Директория для импорта (только для `import`)   | Да (для `import`) | ./local-files
-repo-type        | Тип репозитория: `maven`, `npm`, `raw`, и т.д.  | Да           | maven
-username         | Имя пользователя для аутентификации           | Нет          | admin
-password         | Пароль для аутентификации                     | Нет          | admin123
-dry-run          | Показать, что будет сделано, без изменений   | Нет          | true

## Переменные окружения
Для удобства использования в CI/CD и повышения безопасности, учетные данные можно задавать через переменные окружения. Они имеют более низкий приоритет, чем флаги командной строки.
- NEXUS_USERNAME: Имя пользователя для аутентификации.
- NEXUS_PASSWORD: Пароль для аутентификации.

## Безопасность
Важно: Передача пароля через флаг командной строки (`-password`) может быть небезопасной, так как он может сохраниться в истории командной строки. Для производственного использования рассмотрите возможность использования переменных окружения или других безопасных методов управления секретами.

## Внесение вклада
Мы приветствуем любой вклад! Если вы нашли ошибку или у вас есть идея по улучшению, пожалуйста, создайте `issue` или `pull request` в нашем репозитории.

## Лицензия
Этот проект распространяется под лицензией MIT. Подробности см. в файле `LICENSE`.

## Поиск и устранение неисправностей
- Ошибка "401 Unauthorized": Проверьте правильность имени пользователя и пароля. Убедитесь, что у пользователя есть необходимые права в Nexus.
- Ошибка "connection refused" или "timeout": Проверьте доступность Nexus URL. Возможно, требуется настройка прокси или VPN.
- "Не найдено файлов для загрузки": Убедитесь, что флаг `-repo-type` соответствует файлам в директории `-import-dir`. Например, для `-repo-type=maven` в директории должны быть файлы `.jar` или `.pom`.

### Автор
Ilya Zaissler